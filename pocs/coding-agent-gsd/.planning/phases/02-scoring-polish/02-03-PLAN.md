# Plan 02-03: Hold Piece & Pause

---
wave: 3
depends_on: [02-02]
files_modified:
  - js/input.js
  - js/render.js
  - js/main.js
autonomous: true
---

## Objective

Implement hold piece functionality (swap current with held) and pause/resume with P key.

## Requirements Addressed

- EHNC-02: Hold piece allows swapping current piece (once per drop)
- EHNC-04: Player can pause/resume game with P key

## Tasks

<task id="1">
Add hold and pause key handling in js/input.js.

Add to keydown listener:
- Track 'KeyC' or 'ShiftLeft' for hold
- Track 'KeyP' for pause
- Add to getInput(): hold: boolean, pause: boolean
- Hold should be single-press only (like rotate, use lastRepeat check)
- Pause should be single-press only
</task>

<task id="2">
Add hold piece state in js/main.js.

Add variables:
- let heldPiece = null; (piece type string or null)
- let canHold = true; (reset on each spawn)
</task>

<task id="3">
Implement holdPiece() function in js/main.js.

Logic:
- If !canHold, return (already held this drop)
- If heldPiece is null:
  - Store current piece type in heldPiece
  - Spawn new piece (from nextPiece)
- Else:
  - Swap: temp = currentPiece.type, set currentPiece.type = heldPiece, heldPiece = temp
  - Reset position to spawn point
  - Reset rotation to 0
- Set canHold = false
- Reset lockCounter and isLocking
</task>

<task id="4">
Update spawnPiece() to reset canHold.

Add canHold = true at start of spawnPiece().
</task>

<task id="5">
Add held piece rendering in js/render.js.

Add drawHoldPreview(pieceType) function:
- Draw "HOLD" label at top of sidebar
- Draw preview box below label
- If pieceType is null, draw empty box
- If pieceType exists, draw piece shape centered
- If canHold is false, optionally gray out to show "used"
</task>

<task id="6">
Add pause state in js/main.js.

Add:
- let isPaused = false;

Add togglePause() function:
- Toggle isPaused
- If pausing, could optionally clear key states to prevent stuck keys
</task>

<task id="7">
Add paused overlay in js/render.js.

Add drawPaused() function:
- Semi-transparent dark overlay
- "PAUSED" text centered
- "Press P to resume" below
</task>

<task id="8">
Update processInput() for hold and pause.

Add:
- If input.pause, call togglePause()
- If isPaused, skip all other input processing and return early
- If input.hold, call holdPiece()
</task>

<task id="9">
Update update() and render() for pause.

In update():
- If isPaused, return early (don't update game state)

In render():
- After normal rendering, if isPaused, call drawPaused()
- Always call drawHoldPreview(heldPiece, canHold)
</task>

## Verification

```
- [ ] C key (or Shift) swaps current piece with hold
- [ ] Can only hold once per piece drop
- [ ] Held piece displays in "HOLD" area of sidebar
- [ ] First hold stores piece and spawns next
- [ ] Subsequent holds swap pieces
- [ ] canHold resets when new piece spawns
- [ ] P key pauses the game
- [ ] P key again resumes the game
- [ ] Paused overlay displays "PAUSED" text
- [ ] Game state doesn't update while paused
- [ ] Input (except P) is ignored while paused
```

## Must Haves

1. Hold piece works (store and swap)
2. Hold limited to once per drop
3. P key toggles pause
4. Game freezes while paused
5. Visual indication of paused state
