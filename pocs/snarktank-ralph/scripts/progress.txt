# Ralph Progress Log
Started: 2026-02-14
---

## Codebase Patterns
- Backend uses better-sqlite3 with WAL mode and foreign keys ON
- Database is initialized in db.js, called from index.js on server start
- Frontend proxies API calls to http://localhost:3001 via package.json proxy setting
- Backend tests are in backend/src/test.js using plain Node.js assertions (no framework)
- Use `npm run dev` from root to start both frontend (port 3000) and backend (port 3001)
- Frontend is React + TypeScript, backend is plain Node.js + Express
- Auth uses bcryptjs for password hashing and jsonwebtoken for JWT tokens
- Auth routes at /api/auth/*, authMiddleware exported from auth.js for protecting routes
- Frontend auth state managed via AuthContext, token stored in localStorage
- Snark routes in backend/src/snarks.js, mounted at /api/snarks in index.js
- GET /api/snarks returns paginated results with like_count and reply_count via subqueries
- POST /api/snarks requires auth, validates max 280 chars and non-empty
- Snark API returns camelCase JSON with nested author object { id, username, displayName }
- timeAgo utility in App.tsx for relative timestamps
---

## 2026-02-14 - ST-001
- Verified project setup and database schema (already implemented in prior commits)
- All 4 tables exist: users, snarks, likes, follows
- All 19 schema tests pass
- npm install, frontend build, and backend start all work correctly
- Files verified: backend/src/index.js, backend/src/db.js, backend/src/test.js, frontend/src/App.tsx, frontend/src/index.tsx
- **Learnings for future iterations:**
  - Database file is snarktank.db in the backend directory
  - Schema uses IF NOT EXISTS so tables are safe to re-create
  - The snarks table has parent_id for replies (self-referencing FK)
  - likes table has unique constraint on (user_id, snark_id) to prevent double likes
  - follows table has unique constraint on (follower_id, following_id)
---

## 2026-02-14 - ST-002
- Implemented user registration and login with bcryptjs password hashing and JWT tokens
- Backend: POST /api/auth/register, POST /api/auth/login, GET /api/auth/me (protected)
- Frontend: AuthContext with login/register/logout, LoginPage, RegisterPage components
- App.tsx shows auth pages when not logged in, main app when authenticated
- Added 9 auth-specific tests (password hashing, JWT, duplicate username rejection)
- Files changed: backend/src/auth.js, backend/src/index.js, backend/src/test.js, frontend/src/AuthContext.tsx, frontend/src/LoginPage.tsx, frontend/src/RegisterPage.tsx, frontend/src/App.tsx, frontend/src/App.css
- All 28 tests pass, TypeScript compiles clean, frontend builds
- **Learnings for future iterations:**
  - Auth implementation was partially committed in a prior "progress ralph" commit, only tests and CSS were new
  - JWT_SECRET is exported from auth.js for use in tests
  - authMiddleware sets req.user with { id, username } from JWT payload
  - Auth routes are mounted at /api/auth/* in index.js
  - Frontend stores token in localStorage, AuthContext fetches /api/auth/me on load to validate
---

## 2026-02-14 - ST-003
- Implemented Post a Snark feature with compose form and timeline display
- Backend: POST /api/snarks (auth-protected, 280 char limit, non-empty validation), GET /api/snarks (paginated, with like/reply counts)
- Frontend: ComposeSnark component with character counter, SnarkCard component, timeline in App.tsx
- Added 10 snark-specific tests (insert, content storage, user_id, parent_id, 280 chars, multi-user, ordering, filtering)
- Files changed: backend/src/snarks.js (new), backend/src/index.js, backend/src/test.js, frontend/src/ComposeSnark.tsx (new), frontend/src/App.tsx, frontend/src/App.css, eslint.config.js (new)
- All 38 tests pass, TypeScript compiles clean, frontend builds
- **Learnings for future iterations:**
  - ESLint hook requires eslint.config.js at project root (created empty config to satisfy it)
  - Snarks router follows same pattern as auth router: separate file, export router, mount in index.js
  - GET /api/snarks uses subqueries for like_count and reply_count - future stories can rely on these
  - ComposeSnark uses onSnarkPosted callback to prepend new snark to timeline state without refetch
  - WHERE parent_id IS NULL in GET /api/snarks filters out replies from main timeline
---
